angular.module("angular-typed",[]).directive("typed",["$log","$timeout","$q",function($log,$timeout,$q){function _link(scope,elem,attrs){function newLine(first){var line=angular.element(document.createElement("span")).addClass("typed-line");first?elem.prepend(line):elem.append(line),elem=line}function backspace(text,currPos){var delay=Math.round(70*Math.random())+backSpeed;$timeout(function(){if(htmlMode){var curChar=text.substr(currPos).charAt(0);if(">"===curChar||";"===curChar)for(var tag="",endtag=">"===curChar?"<":"&";text.substr(currPos).charAt(0)!==endtag;)tag+=text.substr(currPos).charAt(0),currPos--}if(0==currPos)return currentLine<strings.length-1?(currentLine++,typeText(strings[currentLine],0)):(angular.isFunction(scope.endCallback)&&scope.$apply(scope.endCallback()),loop?startTyping():null);var nextPos=currPos-1,string=text.substr(0,nextPos);htmlMode?elem.html(string):elem.text(string),backspace(text,nextPos)},delay)}function typeText(text,currPos){var delay=Math.round(70*Math.random())+typeSpeed;$timeout(function(){var charPause=0,substr=text.substr(currPos);if("^"===substr.charAt(0)){var skip=1;/^\^\d+/.test(substr)&&(substr=/\d+/.exec(substr)[0],skip+=substr.length,charPause=parseInt(substr)),text=text.substring(0,currPos)+text.substring(currPos+skip)}if(htmlMode){var curChar=text.substr(currPos).charAt(0);if("<"===curChar||"&"===curChar)for(var tag="",endtag="<"===curChar?">":";";text.substr(currPos).charAt(0)!==endtag;)tag+=text.substr(currPos).charAt(0),currPos++}$timeout(function(){if(currPos==text.length)if(currentLine==strings.length-1){if(!removeLast)return angular.isFunction(scope.endCallback)&&scope.$apply(scope.endCallback()),loop?startTyping():null;backspace(text,currPos)}else{if(!removeLine)return currentLine++,typeText(strings[currentLine],0);backspace(text,currPos)}else{var nextPos=currPos+1,string=text.substr(0,nextPos);htmlMode?elem.html(string):elem.text(string),typeText(text,nextPos)}},charPause)},delay)}function startTyping(first){$timeout(function(){return first&&angular.isFunction(scope.startCallback)&&(scope.startCallback(),newLine(!0)),currentLine=startLine,typeText(strings[currentLine],0)},startTimeout)}var strings=scope.typeStrings||(elem.text()?[elem.text().trim().replace(/\s+/g," ")]:null);if(!strings)return void $log.info("angular-typed: No strings to type found on element: ",elem[0]);var startLine=attrs.startLine||0,currentLine=startLine,htmlMode="undefined"!=typeof attrs.htmlMode,startTimeout=parseInt(attrs.startTimeout)||0,loop="loop"in attrs&&"false"!=attrs.loop,typeSpeed=parseInt(attrs.typeSpeed)||0,backSpeed=parseInt(attrs.backSpeed)||0,removeLine=attrs.removeLine||!0,removeLast=attrs.removeLast||!1,cursor=angular.element(document.createElement("span")).addClass("typed-cursor").text("|");return elem.empty(),elem.append(cursor),startTyping(!0)}var _scope={typeStrings:"=?",startCallback:"&",endCallback:"&"},directive={restrict:"AE",replace:!1,scope:_scope,link:_link};return directive}]);